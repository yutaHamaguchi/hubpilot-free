<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HubPilot Free - SEO記事作成エージェント</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="image-generation-styles.css">
    <link rel="stylesheet" href="auth-styles.css">
</head>
<body>
    <!-- 認証オーバーレイ -->
    <div id="auth-overlay" class="auth-overlay hidden">
        <div class="auth-card">
            <!-- ヘッダー -->
            <div class="auth-header">
                <div class="auth-logo">🚀</div>
                <h2>HubPilot Free</h2>
                <p class="auth-subtitle">AI記事作成エージェント</p>
            </div>

            <!-- 通知メッセージ -->
            <div id="auth-message" class="auth-message"></div>

            <!-- タブ切替 -->
            <div class="auth-tabs">
                <button class="active" data-tab="signin" onclick="switchAuthTab('signin')">
                    ログイン
                </button>
                <button data-tab="signup" onclick="switchAuthTab('signup')">
                    新規登録
                </button>
            </div>

            <!-- ログインフォーム -->
            <form id="signin-form" class="auth-form active" onsubmit="handleSignIn(event)">
                <div class="form-group">
                    <label for="signin-email">メールアドレス</label>
                    <input
                        type="email"
                        id="signin-email"
                        placeholder="your@email.com"
                        required
                        autocomplete="email"
                    >
                </div>

                <div class="form-group">
                    <label for="signin-password">パスワード</label>
                    <input
                        type="password"
                        id="signin-password"
                        placeholder="••••••••"
                        required
                        autocomplete="current-password"
                    >
                    <div class="password-reset-link">
                        <button type="button" onclick="showPasswordReset()">
                            パスワードを忘れた方
                        </button>
                    </div>
                </div>

                <button type="submit" class="auth-button" id="signin-button">
                    ログイン
                </button>
            </form>

            <!-- 新規登録フォーム -->
            <form id="signup-form" class="auth-form" onsubmit="handleSignUp(event)">
                <div class="form-group">
                    <label for="signup-name">表示名（オプション）</label>
                    <input
                        type="text"
                        id="signup-name"
                        placeholder="山田太郎"
                        autocomplete="name"
                    >
                </div>

                <div class="form-group">
                    <label for="signup-email">メールアドレス</label>
                    <input
                        type="email"
                        id="signup-email"
                        placeholder="your@email.com"
                        required
                        autocomplete="email"
                    >
                </div>

                <div class="form-group">
                    <label for="signup-password">パスワード（8文字以上）</label>
                    <input
                        type="password"
                        id="signup-password"
                        placeholder="••••••••"
                        required
                        minlength="8"
                        autocomplete="new-password"
                    >
                </div>

                <div class="form-group">
                    <label for="signup-password-confirm">パスワード確認</label>
                    <input
                        type="password"
                        id="signup-password-confirm"
                        placeholder="••••••••"
                        required
                        minlength="8"
                        autocomplete="new-password"
                    >
                    <div id="password-error" class="form-error"></div>
                </div>

                <button type="submit" class="auth-button" id="signup-button">
                    新規登録
                </button>
            </form>

            <!-- ソーシャルログイン -->
            <div class="social-login">
                <div class="social-login-title">または</div>

                <button class="social-button" onclick="handleSocialLogin('google')">
                    <svg width="20" height="20" viewBox="0 0 24 24">
                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    Googleでログイン
                </button>

                <button class="social-button" onclick="handleSocialLogin('github')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="#333">
                        <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                    </svg>
                    GitHubでログイン
                </button>
            </div>

            <!-- ゲストログイン -->
            <div class="guest-login">
                <button class="link-button" onclick="handleGuestLogin()">
                    ゲストとして続ける（データはローカルのみ保存）
                </button>
            </div>
        </div>
    </div>

    <!-- メインアプリケーション -->
    <div id="main-app" class="hidden">
        <!-- 全体プログレスバー -->
        <div class="overall-progress-container">
            <div class="overall-progress"></div>
        </div>

        <div class="app-container">
        <!-- サイドバー（ステップインジケーター） -->
        <aside class="sidebar">
            <div class="logo">
                <h1>HubPilot Free</h1>
                <p>SEO記事作成エージェント</p>

                <!-- データ管理メニュー -->
                <div class="data-management">
                    <button class="btn btn-small btn-secondary" id="data-menu-btn" title="データ管理">
                        <span class="btn-icon">⚙️</span>
                    </button>

                    <div class="data-menu" id="data-menu" style="display: none;">
                        <div class="menu-item" onclick="app.exportData()">
                            <span class="menu-icon">📤</span>
                            <span>データをエクスポート</span>
                        </div>
                        <div class="menu-item" onclick="document.getElementById('import-file').click()">
                            <span class="menu-icon">📥</span>
                            <span>データをインポート</span>
                        </div>
                        <div class="menu-item" onclick="app.showBackupList()">
                            <span class="menu-icon">🔄</span>
                            <span>バックアップ管理</span>
                        </div>
                        <div class="menu-item" onclick="app.showStorageInfo()">
                            <span class="menu-icon">💾</span>
                            <span>ストレージ情報</span>
                        </div>
                        <div class="menu-item danger" onclick="app.confirmResetData()">
                            <span class="menu-icon">🗑️</span>
                            <span>データをリセット</span>
                        </div>
                    </div>

                    <input type="file" id="import-file" accept=".json" style="display: none;">
                </div>
            </div>

            <nav class="step-navigation">
                <div class="step-item active" data-step="1">
                    <div class="step-number">1</div>
                    <div class="step-info">
                        <h3>テーマ設定</h3>
                        <p>メインテーマを入力</p>
                    </div>
                </div>

                <div class="step-item" data-step="2">
                    <div class="step-number">2</div>
                    <div class="step-info">
                        <h3>構成案確認</h3>
                        <p>ピラー・クラスター構成</p>
                    </div>
                </div>

                <div class="step-item" data-step="3">
                    <div class="step-number">3</div>
                    <div class="step-info">
                        <h3>見出し構成</h3>
                        <p>各記事の見出し設定</p>
                    </div>
                </div>

                <div class="step-item" data-step="4">
                    <div class="step-number">4</div>
                    <div class="step-info">
                        <h3>記事執筆</h3>
                        <p>コンテンツ生成進捗</p>
                    </div>
                </div>

                <div class="step-item" data-step="5">
                    <div class="step-number">5</div>
                    <div class="step-info">
                        <h3>品質チェック</h3>
                        <p>記事の品質確認</p>
                    </div>
                </div>

                <div class="step-item" data-step="6">
                    <div class="step-number">6</div>
                    <div class="step-info">
                        <h3>最終承認</h3>
                        <p>ピラーページ統合</p>
                    </div>
                </div>
            </nav>
        </aside>

        <!-- メインコンテンツエリア -->
        <main class="main-content">
            <div class="content-wrapper">
                <!-- ステップ1: テーマ設定 -->
                <div class="step-content active" id="step-1">
                    <div class="step-header">
                        <h2>メインテーマを設定してください</h2>
                        <p>あなたのコンテンツ戦略の中心となるテーマを入力してください。<br>
                        このテーマから、1つのピラーページと10個のクラスターページを自動生成します。</p>
                    </div>

                    <div class="input-section">
                        <div class="theme-input-container">
                            <label for="theme-input" class="input-label">
                                コンテンツテーマ
                                <span class="required-mark">*</span>
                            </label>

                            <div class="input-wrapper">
                                <input
                                    type="text"
                                    id="theme-input"
                                    class="theme-input"
                                    placeholder="例：Instagramマーケティング"
                                    maxlength="100"
                                    autocomplete="off"
                                />
                                <div class="input-icon">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M9 12l2 2 4-4"></path>
                                        <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"></path>
                                        <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"></path>
                                    </svg>
                                </div>
                            </div>

                            <div class="input-help">
                                <div class="character-count">
                                    <span id="char-count">0</span>/100文字
                                </div>
                            </div>

                            <div class="input-error" id="theme-error"></div>
                        </div>

                        <!-- テーマ例の表示 -->
                        <div class="theme-examples">
                            <h4>テーマ例</h4>
                            <div class="examples-grid">
                                <button class="example-btn" data-theme="Instagramマーケティング">
                                    <span class="example-icon">📱</span>
                                    <span class="example-text">Instagramマーケティング</span>
                                </button>
                                <button class="example-btn" data-theme="SEO対策">
                                    <span class="example-icon">🔍</span>
                                    <span class="example-text">SEO対策</span>
                                </button>
                                <button class="example-btn" data-theme="コンテンツマーケティング">
                                    <span class="example-icon">📝</span>
                                    <span class="example-text">コンテンツマーケティング</span>
                                </button>
                                <button class="example-btn" data-theme="Webデザイン">
                                    <span class="example-icon">🎨</span>
                                    <span class="example-text">Webデザイン</span>
                                </button>
                                <button class="example-btn" data-theme="デジタルマーケティング">
                                    <span class="example-icon">💻</span>
                                    <span class="example-text">デジタルマーケティング</span>
                                </button>
                                <button class="example-btn" data-theme="ブランディング">
                                    <span class="example-icon">✨</span>
                                    <span class="example-text">ブランディング</span>
                                </button>
                            </div>
                        </div>

                        <div class="action-section">
                            <button class="btn btn-primary btn-large" id="generate-structure-btn" disabled>
                                <span class="btn-icon">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path>
                                    </svg>
                                </span>
                                構成案を作成
                            </button>

                            <div class="action-help">
                                <p>💡 入力したテーマから、SEOに最適化された記事構成を自動生成します</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ステップ2: 構成案確認 -->
                <div class="step-content" id="step-2">
                    <div class="step-header">
                        <h2>構成案を確認してください</h2>
                        <p>生成された構成案を確認し、必要に応じて編集してください。<br>
                        この構成に基づいて、SEOに最適化された記事群を作成します。</p>
                    </div>

                    <div class="structure-section">
                        <!-- ピラーページセクション -->
                        <div class="pillar-page-section">
                            <div class="section-header">
                                <h3>
                                    <span class="section-icon">🏛️</span>
                                    ピラーページ
                                </h3>
                                <div class="section-badge">メイン記事</div>
                            </div>

                            <div class="pillar-page-card">
                                <div class="pillar-page-title" id="pillar-page-title">
                                    <!-- ピラーページタイトルがここに表示される -->
                                </div>
                                <div class="pillar-page-actions">
                                    <button class="btn btn-small btn-secondary" id="edit-pillar-btn">
                                        <span class="btn-icon">✏️</span>
                                        編集
                                    </button>
                                </div>
                            </div>

                            <div class="pillar-page-info">
                                <p>💡 ピラーページは、テーマ全体を包括的にカバーする中心的な記事です。</p>
                            </div>
                        </div>

                        <!-- クラスターページセクション -->
                        <div class="cluster-pages-section">
                            <div class="section-header">
                                <h3>
                                    <span class="section-icon">📚</span>
                                    クラスターページ
                                </h3>
                                <div class="section-badge">10記事</div>
                            </div>

                            <div class="cluster-pages-controls">
                                <div class="controls-left">
                                    <button class="btn btn-small btn-secondary" id="add-cluster-btn">
                                        <span class="btn-icon">➕</span>
                                        記事を追加
                                    </button>
                                    <button class="btn btn-small btn-secondary" id="regenerate-cluster-btn">
                                        <span class="btn-icon">🔄</span>
                                        再生成
                                    </button>
                                </div>
                                <div class="controls-right">
                                    <span class="cluster-count">
                                        <span id="cluster-count">10</span>記事
                                    </span>
                                </div>
                            </div>

                            <div class="cluster-pages-list" id="cluster-pages-list">
                                <!-- クラスターページリストがここに表示される -->
                            </div>

                            <div class="cluster-pages-info">
                                <p>💡 クラスターページは、ピラーページの各トピックを詳しく解説する専門記事です。</p>
                            </div>
                        </div>

                        <!-- アクションセクション -->
                        <div class="action-section">
                            <div class="structure-summary">
                                <div class="summary-item">
                                    <span class="summary-icon">🏛️</span>
                                    <span class="summary-text">ピラーページ: 1記事</span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-icon">📚</span>
                                    <span class="summary-text">クラスターページ: <span id="summary-cluster-count">10</span>記事</span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-icon">📊</span>
                                    <span class="summary-text">合計: <span id="summary-total-count">11</span>記事</span>
                                </div>
                            </div>

                            <button class="btn btn-primary btn-large" id="proceed-to-headings-btn">
                                <span class="btn-icon">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M9 18l6-6-6-6"></path>
                                    </svg>
                                </span>
                                この構成で進める
                            </button>

                            <div class="action-help">
                                <p>🚀 次のステップで、各記事の見出し構成を設定します</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ステップ3: 見出し構成 -->
                <div class="step-content" id="step-3">
                    <div class="step-header">
                        <h2>見出し構成を確認してください</h2>
                        <p>各クラスターページの見出し構成を確認し、必要に応じて編集してください。<br>
                        この見出し構成に基づいて、SEOに最適化された記事を生成します。</p>
                    </div>

                    <div class="headings-section">
                        <!-- 見出し構成の統計 -->
                        <div class="headings-stats">
                            <div class="stats-item">
                                <span class="stats-icon">📚</span>
                                <span class="stats-text">
                                    <strong id="total-articles">10</strong>記事
                                </span>
                            </div>
                            <div class="stats-item">
                                <span class="stats-icon">📝</span>
                                <span class="stats-text">
                                    <strong id="total-headings">40</strong>見出し
                                </span>
                            </div>
                            <div class="stats-item">
                                <span class="stats-icon">⏱️</span>
                                <span class="stats-text">
                                    約<strong id="estimated-time">25</strong>分で生成
                                </span>
                            </div>
                        </div>

                        <!-- 見出し構成コントロール -->
                        <div class="headings-controls">
                            <div class="controls-left">
                                <button class="btn btn-small btn-secondary" id="expand-all-btn">
                                    <span class="btn-icon">📖</span>
                                    すべて展開
                                </button>
                                <button class="btn btn-small btn-secondary" id="collapse-all-btn">
                                    <span class="btn-icon">📕</span>
                                    すべて折りたたみ
                                </button>
                                <button class="btn btn-small btn-secondary" id="regenerate-headings-btn">
                                    <span class="btn-icon">🔄</span>
                                    見出し再生成
                                </button>
                            </div>
                            <div class="controls-right">
                                <div class="view-toggle">
                                    <button class="toggle-btn active" data-view="accordion">
                                        <span class="btn-icon">📋</span>
                                        アコーディオン
                                    </button>
                                    <button class="toggle-btn" data-view="list">
                                        <span class="btn-icon">📄</span>
                                        リスト
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- アコーディオンビュー -->
                        <div class="headings-accordion" id="headings-accordion">
                            <!-- 見出し構成がここに表示される -->
                        </div>

                        <!-- リストビュー -->
                        <div class="headings-list-view" id="headings-list-view" style="display: none;">
                            <!-- リスト形式の見出し構成がここに表示される -->
                        </div>

                        <!-- アクションセクション -->
                        <div class="action-section">
                            <div class="headings-summary">
                                <div class="summary-card">
                                    <h4>📊 構成サマリー</h4>
                                    <div class="summary-grid">
                                        <div class="summary-item">
                                            <span class="summary-label">平均見出し数</span>
                                            <span class="summary-value" id="avg-headings">4.0</span>
                                        </div>
                                        <div class="summary-item">
                                            <span class="summary-label">推定文字数</span>
                                            <span class="summary-value" id="estimated-words">20,000</span>
                                        </div>
                                        <div class="summary-item">
                                            <span class="summary-label">SEO最適化</span>
                                            <span class="summary-value">✅ 完了</span>
                                        </div>
                                        <div class="summary-item">
                                            <span class="summary-label">内部リンク</span>
                                            <span class="summary-value" id="internal-links">45</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <button class="btn btn-primary btn-large" id="start-writing-btn">
                                <span class="btn-icon">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
                                    </svg>
                                </span>
                                記事執筆を開始（時間がかかります）
                            </button>

                            <div class="action-help">
                                <p>🚀 次のステップで、各記事の本文を自動生成します</p>
                                <p>💡 生成には約25分かかります。途中でブラウザを閉じないでください。</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ステップ4: 記事執筆進捗 -->
                <div class="step-content" id="step-4">
                    <div class="step-header">
                        <h2>記事を執筆中です</h2>
                        <p>AIが各記事の本文を生成しています。生成には時間がかかりますが、しばらくお待ちください。<br>
                        生成が完了した記事から順次プレビューできます。</p>
                    </div>

                    <div class="progress-section">
                        <!-- 全体進捗表示 -->
                        <div class="overall-progress-card">
                            <div class="progress-header">
                                <h3>
                                    <span class="progress-icon">⚡</span>
                                    記事生成進捗
                                </h3>
                                <div class="progress-status" id="progress-status">準備中...</div>
                            </div>

                            <div class="progress-bar-container">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="progress-fill"></div>
                                    <div class="progress-percentage" id="progress-percentage">0%</div>
                                </div>
                                <div class="progress-text" id="progress-text">記事 0/10 を作成中...</div>
                            </div>

                            <div class="progress-stats">
                                <div class="stat-item">
                                    <span class="stat-icon">✅</span>
                                    <span class="stat-text">
                                        完了: <strong id="completed-count">0</strong>記事
                                    </span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-icon">⏳</span>
                                    <span class="stat-text">
                                        残り: <strong id="remaining-count">10</strong>記事
                                    </span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-icon">🕒</span>
                                    <span class="stat-text">
                                        推定残り時間: <strong id="estimated-remaining">25分</strong>
                                    </span>
                                </div>
                            </div>
                        </div>

                        <!-- 記事生成コントロール -->
                        <div class="generation-controls">
                            <div class="controls-left">
                                <button class="btn btn-small btn-secondary" id="pause-generation-btn" style="display: none;">
                                    <span class="btn-icon">⏸️</span>
                                    一時停止
                                </button>
                                <button class="btn btn-small btn-secondary" id="resume-generation-btn" style="display: none;">
                                    <span class="btn-icon">▶️</span>
                                    再開
                                </button>
                                <button class="btn btn-small btn-secondary" id="cancel-generation-btn" style="display: none;">
                                    <span class="btn-icon">⏹️</span>
                                    キャンセル
                                </button>
                            </div>
                            <div class="controls-right">
                                <div class="generation-speed">
                                    <span class="speed-label">生成速度:</span>
                                    <span class="speed-value" id="generation-speed">2.4記事/分</span>
                                </div>
                            </div>
                        </div>

                        <!-- 記事カードグリッド -->
                        <div class="articles-grid" id="articles-grid">
                            <!-- 記事カードがここに表示される -->
                        </div>

                        <!-- 完了アクション -->
                        <div class="completion-section" id="completion-section" style="display: none;">
                            <div class="completion-card">
                                <div class="completion-icon">🎉</div>
                                <h3>記事生成が完了しました！</h3>
                                <p>全<span id="total-generated">10</span>記事の生成が正常に完了しました。次のステップで品質チェックを行います。</p>

                                <div class="completion-stats">
                                    <div class="completion-stat">
                                        <span class="stat-number" id="total-words">20,000</span>
                                        <span class="stat-label">総文字数</span>
                                    </div>
                                    <div class="completion-stat">
                                        <span class="stat-number" id="total-time">24分</span>
                                        <span class="stat-label">生成時間</span>
                                    </div>
                                    <div class="completion-stat">
                                        <span class="stat-number">100%</span>
                                        <span class="stat-label">成功率</span>
                                    </div>
                                </div>

                                <button class="btn btn-primary btn-large" id="proceed-to-quality-btn">
                                    <span class="btn-icon">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M9 12l2 2 4-4"></path>
                                            <circle cx="12" cy="12" r="10"></circle>
                                        </svg>
                                    </span>
                                    品質チェックへ進む
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ステップ5: 品質チェック -->
                <div class="step-content" id="step-5">
                    <div class="step-header">
                        <h2>品質チェック</h2>
                        <p>生成された記事の品質をAIが自動チェックしています。<br>
                        問題が検出された記事については、修正提案を確認して改善してください。</p>
                    </div>

                    <div class="quality-check-section">
                        <!-- 品質チェック統計 -->
                        <div class="quality-stats-card">
                            <div class="stats-header">
                                <h3>
                                    <span class="stats-icon">🔍</span>
                                    品質チェック結果
                                </h3>
                                <div class="check-status" id="check-status">チェック中...</div>
                            </div>

                            <div class="quality-overview">
                                <div class="overview-item success">
                                    <div class="overview-number" id="passed-count">0</div>
                                    <div class="overview-label">合格</div>
                                </div>
                                <div class="overview-item warning">
                                    <div class="overview-number" id="warning-count">0</div>
                                    <div class="overview-label">要注意</div>
                                </div>
                                <div class="overview-item error">
                                    <div class="overview-number" id="failed-count">0</div>
                                    <div class="overview-label">要修正</div>
                                </div>
                            </div>

                            <div class="quality-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="quality-progress-fill"></div>
                                </div>
                                <div class="progress-text" id="quality-progress-text">品質チェック 0/10 完了</div>
                            </div>
                        </div>

                        <!-- 品質チェックコントロール -->
                        <div class="quality-controls">
                            <div class="controls-left">
                                <button class="btn btn-small btn-secondary" id="recheck-all-btn">
                                    <span class="btn-icon">🔄</span>
                                    全記事再チェック
                                </button>
                                <button class="btn btn-small btn-secondary" id="auto-fix-btn">
                                    <span class="btn-icon">🛠️</span>
                                    自動修正
                                </button>
                                <button class="btn btn-small btn-secondary" id="export-report-btn">
                                    <span class="btn-icon">📊</span>
                                    レポート出力
                                </button>
                            </div>
                            <div class="controls-right">
                                <div class="filter-toggle">
                                    <button class="filter-btn active" data-filter="all">すべて</button>
                                    <button class="filter-btn" data-filter="passed">合格</button>
                                    <button class="filter-btn" data-filter="warning">要注意</button>
                                    <button class="filter-btn" data-filter="failed">要修正</button>
                                </div>
                            </div>
                        </div>

                        <!-- 品質チェック結果リスト -->
                        <div class="quality-results" id="quality-results">
                            <!-- 品質チェック結果がここに表示される -->
                        </div>

                        <!-- アクションセクション -->
                        <div class="action-section">
                            <div class="quality-summary">
                                <div class="summary-card">
                                    <h4>📋 品質サマリー</h4>
                                    <div class="summary-grid">
                                        <div class="summary-item">
                                            <span class="summary-label">平均品質スコア</span>
                                            <span class="summary-value" id="avg-quality-score">85%</span>
                                        </div>
                                        <div class="summary-item">
                                            <span class="summary-label">SEO最適化率</span>
                                            <span class="summary-value" id="seo-optimization">92%</span>
                                        </div>
                                        <div class="summary-item">
                                            <span class="summary-label">読みやすさ</span>
                                            <span class="summary-value" id="readability-score">良好</span>
                                        </div>
                                        <div class="summary-item">
                                            <span class="summary-label">推定改善時間</span>
                                            <span class="summary-value" id="improvement-time">15分</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <button class="btn btn-primary btn-large" id="create-pillar-btn">
                                <span class="btn-icon">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <polyline points="14,2 14,8 20,8"></polyline>
                                        <line x1="16" y1="13" x2="8" y2="13"></line>
                                        <line x1="16" y1="17" x2="8" y2="17"></line>
                                        <polyline points="10,9 9,9 8,9"></polyline>
                                    </svg>
                                </span>
                                ピラーページを作成して統合
                            </button>

                            <div class="action-help">
                                <p>🚀 次のステップで、すべての記事を統合したピラーページを作成します</p>
                                <p>💡 品質に問題がある記事も統合されますが、後から個別に修正できます</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ステップ6: 最終承認 -->
                <div class="step-content" id="step-6">
                    <div class="step-header">
                        <h2>最終承認</h2>
                        <p>ピラーページが完成しました。内容を確認してから公開してください。<br>
                        すべての記事が統合され、SEOに最適化されたコンテンツ群が完成しています。</p>
                    </div>

                    <div class="final-approval-section">
                        <!-- 完成統計 -->
                        <div class="completion-stats-card">
                            <div class="stats-header">
                                <h3>
                                    <span class="stats-icon">📊</span>
                                    完成統計
                                </h3>
                                <div class="completion-badge">完了</div>
                            </div>

                            <div class="completion-overview">
                                <div class="completion-item">
                                    <div class="completion-number" id="final-total-articles">11</div>
                                    <div class="completion-label">総記事数</div>
                                </div>
                                <div class="completion-item">
                                    <div class="completion-number" id="final-total-words">22,000</div>
                                    <div class="completion-label">総文字数</div>
                                </div>
                                <div class="completion-item">
                                    <div class="completion-number" id="final-avg-quality">87点</div>
                                    <div class="completion-label">平均品質</div>
                                </div>
                                <div class="completion-item">
                                    <div class="completion-number" id="final-seo-score">92%</div>
                                    <div class="completion-label">SEO最適化</div>
                                </div>
                            </div>
                        </div>

                        <!-- ピラーページプレビュー -->
                        <div class="pillar-preview-card">
                            <div class="preview-header">
                                <h3>
                                    <span class="preview-icon">🏛️</span>
                                    ピラーページプレビュー
                                </h3>
                                <div class="preview-actions">
                                    <button class="btn btn-small btn-secondary" id="edit-pillar-preview-btn">
                                        <span class="btn-icon">✏️</span>
                                        編集
                                    </button>
                                    <button class="btn btn-small btn-secondary" id="preview-fullscreen-btn">
                                        <span class="btn-icon">🔍</span>
                                        全画面表示
                                    </button>
                                </div>
                            </div>

                            <div class="pillar-preview-content" id="pillar-preview">
                                <!-- ピラーページプレビューがここに表示される -->
                            </div>
                        </div>

                        <!-- 内部リンク構造の視覚化 -->
                        <div class="link-structure-card">
                            <div class="structure-header">
                                <h3>
                                    <span class="structure-icon">🔗</span>
                                    内部リンク構造
                                </h3>
                                <div class="structure-toggle">
                                    <button class="btn btn-small btn-secondary" id="toggle-structure-btn">
                                        <span class="btn-icon">👁️</span>
                                        表示切替
                                    </button>
                                </div>
                            </div>

                            <div class="link-structure-visual" id="link-structure-visual">
                                <!-- 内部リンク構造の視覚化がここに表示される -->
                            </div>
                        </div>

                        <!-- 画像生成セクション -->
                        <div class="image-generation-card">
                            <div class="image-gen-header">
                                <h3>
                                    <span class="image-gen-icon">🎨</span>
                                    記事画像の自動生成
                                </h3>
                                <div class="image-gen-status">
                                    <span class="status-badge" id="image-gen-status">未生成</span>
                                </div>
                            </div>

                            <div class="image-gen-description">
                                <p>各記事にヒーロー画像と説明画像（2〜3枚）を自動生成します。</p>
                                <p>AIが記事内容を分析し、適切な画像を生成してMarkdownに自動挿入します。</p>
                            </div>

                            <div class="image-gen-options">
                                <div class="option-row">
                                    <label class="checkbox-label">
                                        <input type="checkbox" checked id="generate-hero">
                                        <span>ヒーロー画像を生成（1枚/記事）</span>
                                    </label>
                                    <span class="option-info">記事のメイン画像</span>
                                </div>

                                <div class="option-row">
                                    <label class="checkbox-label">
                                        <input type="checkbox" checked id="generate-illustrations">
                                        <span>説明画像を生成</span>
                                    </label>
                                    <select id="illustration-count" class="illustration-count-select">
                                        <option value="2">2枚/記事</option>
                                        <option value="3" selected>3枚/記事</option>
                                    </select>
                                </div>

                                <div class="option-row">
                                    <label class="select-label">
                                        <span>画像生成プロバイダー:</span>
                                        <select id="image-provider" class="provider-select">
                                            <option value="auto">自動選択（コスト最適化）</option>
                                            <option value="dalle3">DALL-E 3（高品質 - $0.20/記事）</option>
                                            <option value="stability">Stability AI（低コスト - $0.04/記事）</option>
                                        </select>
                                    </label>
                                </div>
                            </div>

                            <div class="cost-estimate-panel">
                                <div class="cost-item">
                                    <span class="cost-label">推定コスト:</span>
                                    <span class="cost-value" id="image-cost-estimate">$2.00</span>
                                </div>
                                <div class="cost-item">
                                    <span class="cost-label">記事数:</span>
                                    <span class="cost-value" id="image-article-count">10</span>
                                </div>
                                <div class="cost-item">
                                    <span class="cost-label">総画像数:</span>
                                    <span class="cost-value" id="image-total-count">40</span>
                                </div>
                            </div>

                            <div class="image-gen-actions">
                                <button class="btn btn-primary btn-large" id="generate-images-btn">
                                    <span class="btn-icon">🎨</span>
                                    画像を生成
                                </button>
                                <button class="btn btn-secondary" id="skip-images-btn" style="display: none;">
                                    画像生成をスキップ
                                </button>
                            </div>

                            <!-- 生成進捗 -->
                            <div class="image-generation-progress" id="image-generation-progress" style="display: none;">
                                <div class="progress-header">
                                    <h4>画像生成中...</h4>
                                    <span id="image-progress-status">準備中</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" id="image-progress-fill"></div>
                                </div>
                                <div class="progress-details">
                                    <p id="image-progress-text">画像生成中... (0/10)</p>
                                    <p id="image-current-article"></p>
                                    <p class="progress-cost">コスト: <span id="image-current-cost">$0.00</span></p>
                                </div>
                            </div>

                            <!-- 画像プレビュー -->
                            <div class="generated-images-preview" id="generated-images-preview" style="display: none;">
                                <div class="preview-header">
                                    <h4>生成された画像</h4>
                                    <button class="btn btn-small btn-secondary" id="toggle-images-preview">
                                        <span class="btn-icon">👁️</span>
                                        すべて表示
                                    </button>
                                </div>
                                <div class="images-grid" id="images-grid">
                                    <!-- 画像カードがここに動的に追加される -->
                                </div>
                            </div>
                        </div>

                        <!-- 最終アクション -->
                        <div class="final-actions-card">
                            <div class="actions-header">
                                <h3>
                                    <span class="actions-icon">🚀</span>
                                    公開オプション
                                </h3>
                                <div class="actions-info">
                                    <span>すべての記事が準備完了です</span>
                                </div>
                            </div>

                            <div class="final-actions">
                                <div class="action-group">
                                    <button class="btn btn-secondary btn-large" id="download-all-btn">
                                        <span class="btn-icon">
                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                                <polyline points="7,10 12,15 17,10"></polyline>
                                                <line x1="12" y1="15" x2="12" y2="3"></line>
                                            </svg>
                                        </span>
                                        全記事をダウンロード
                                    </button>
                                    <div class="action-description">
                                        <p>HTML、Markdown、またはWordファイルとしてダウンロード</p>
                                    </div>
                                </div>

                                <div class="action-group">
                                    <button class="btn btn-primary btn-large" id="publish-cms-btn">
                                        <span class="btn-icon">
                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
                                            </svg>
                                        </span>
                                        CMSへ投稿
                                    </button>
                                    <div class="action-description">
                                        <p>WordPress、HubSpot、またはその他のCMSに直接投稿</p>
                                    </div>
                                </div>
                            </div>

                            <div class="final-notes">
                                <div class="note-item">
                                    <span class="note-icon">💡</span>
                                    <span>記事は公開後も編集・更新が可能です</span>
                                </div>
                                <div class="note-item">
                                    <span class="note-icon">🔍</span>
                                    <span>SEO効果の測定は公開から2-4週間後に確認してください</span>
                                </div>
                                <div class="note-item">
                                    <span class="note-icon">📈</span>
                                    <span>内部リンクの効果を最大化するため、定期的な更新をお勧めします</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ナビゲーションボタン -->
            <div class="navigation-buttons">
                <button class="btn btn-secondary" id="prev-btn">
                    ← 戻る
                </button>
                <button class="btn btn-primary" id="next-btn">
                    次へ →
                </button>
            </div>
        </main>
    </div>
    </div><!-- /main-app -->

    <!-- ローディングオーバーレイ -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">処理中...</div>
    </div>

    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Supabase設定 -->
    <script src="supabase-config.js"></script>

    <!-- Supabase統合レイヤー -->
    <script src="supabase-integration.js"></script>

    <!-- 認証マネージャー -->
    <script src="auth-manager.js"></script>

    <!-- 認証UI JavaScript -->
    <script>
        // タブ切替
        function switchAuthTab(tab) {
            document.querySelectorAll('.auth-tabs button').forEach(btn => {
                btn.classList.remove('active')
            })
            document.querySelector(`[data-tab="${tab}"]`).classList.add('active')

            document.querySelectorAll('.auth-form').forEach(form => {
                form.classList.remove('active')
            })
            document.getElementById(`${tab}-form`).classList.add('active')

            hideAuthMessage()
        }

        // ログイン処理
        async function handleSignIn(event) {
            event.preventDefault()
            const email = document.getElementById('signin-email').value
            const password = document.getElementById('signin-password').value
            const button = document.getElementById('signin-button')

            button.disabled = true
            button.classList.add('loading')

            try {
                await window.authManager.signIn(email, password)
                showAuthMessage('ログインしました', 'success')
            } catch (error) {
                console.error('ログインエラー:', error)
                showAuthMessage(
                    error.message || 'ログインに失敗しました。メールアドレスとパスワードを確認してください。',
                    'error'
                )
            } finally {
                button.disabled = false
                button.classList.remove('loading')
            }
        }

        // 新規登録処理
        async function handleSignUp(event) {
            event.preventDefault()
            const name = document.getElementById('signup-name').value
            const email = document.getElementById('signup-email').value
            const password = document.getElementById('signup-password').value
            const confirmPassword = document.getElementById('signup-password-confirm').value
            const button = document.getElementById('signup-button')

            if (password !== confirmPassword) {
                document.getElementById('password-error').textContent = 'パスワードが一致しません'
                document.getElementById('password-error').classList.add('visible')
                return
            } else {
                document.getElementById('password-error').classList.remove('visible')
            }

            button.disabled = true
            button.classList.add('loading')

            try {
                const result = await window.authManager.signUp(email, password, name)

                if (result.requiresEmailConfirmation) {
                    showAuthMessage('確認メールを送信しました。メールをご確認ください。', 'info')
                    setTimeout(() => switchAuthTab('signin'), 3000)
                } else {
                    showAuthMessage('アカウントを作成しました', 'success')
                }
            } catch (error) {
                console.error('登録エラー:', error)
                showAuthMessage(
                    error.message || '登録に失敗しました。別のメールアドレスをお試しください。',
                    'error'
                )
            } finally {
                button.disabled = false
                button.classList.remove('loading')
            }
        }

        // ソーシャルログイン
        async function handleSocialLogin(provider) {
            try {
                await window.authManager.signInWithProvider(provider)
            } catch (error) {
                console.error('ソーシャルログインエラー:', error)
                showAuthMessage(`${provider}でのログインに失敗しました`, 'error')
            }
        }

        // ゲストログイン
        function handleGuestLogin() {
            window.authManager.continueAsGuest()
        }

        // パスワードリセット
        async function showPasswordReset() {
            const email = document.getElementById('signin-email').value

            if (!email) {
                showAuthMessage('メールアドレスを入力してください', 'error')
                return
            }

            const confirmed = confirm(`${email} にパスワードリセットメールを送信しますか？`)

            if (!confirmed) return

            try {
                await window.authManager.sendPasswordResetEmail(email)
                showAuthMessage('パスワードリセットメールを送信しました', 'success')
            } catch (error) {
                console.error('パスワードリセットエラー:', error)
                showAuthMessage('メール送信に失敗しました', 'error')
            }
        }

        // メッセージ表示
        function showAuthMessage(message, type) {
            const messageEl = document.getElementById('auth-message')
            messageEl.textContent = message
            messageEl.className = `auth-message visible ${type}`
        }

        // メッセージ非表示
        function hideAuthMessage() {
            const messageEl = document.getElementById('auth-message')
            messageEl.classList.remove('visible')
        }
    </script>

    <script src="app.js"></script>

    <!-- 画像生成機能 -->
    <script src="image-generation.js"></script>
</body>
</html>